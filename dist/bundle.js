$(window).on("load",(function(){var e={},a='"https://docs.google.com/spreadsheets/d/1GkdZoHTxtHV6YKbDLwZ9v9ukU6asVE6YNo2RobFmjRM/edit#gid=0";',t="AIzaSyAaP5pZnEgogxlg2rEseiXcG9oTcOFq448";function o(a){return e[constants[a]]}function r(e,a){return(e=o(e))&&""!==e.trim()?e:a}function n(t,n){var s;!function(a){for(var i in a){var t=a[i];e[t.Setting]=t.Customize}}(t),document.title=o("_mapTitle"),$("#header").append("<h1>"+(o("_mapTitle")||"")+"</h1>"),$("#header").append("<h2>"+(o("_mapSubtitle")||"")+"</h2>"),o("_mapLogo")?($("#logo").append('<img src="'+o("_mapLogo")+'" />'),$("#top").css("height","60px")):($("#logo").css("display","none"),$("#header").css("padding-top","25px")),s=r("_tileProvider","Stamen.TonerLite"),L.tileLayer.provider(s,{maxZoom:18}).addTo(map),"off"!==o("_zoomControls")&&L.control.zoom({position:o("_zoomControls")}).addTo(map);var l,p,c,d,f,u,g,h=[],m=function(e){for(var a=0;a<h.length;a++)h[a]&&h[a]._icon&&(h[a]._icon.className=h[a]._icon.className.replace(" marker-active",""),a==e&&(h[e]._icon.className+=" marker-active"))},v=[],y=0;for(i in n){var b=n[i];if(isNaN(parseFloat(b.Latitude))||isNaN(parseFloat(b.Longitude)))h.push(null);else{var C=parseFloat(b.Latitude),k=parseFloat(b.Longitude);y+=1,h.push(L.marker([C,k],{icon:L.ExtraMarkers.icon({icon:"fa-number",number:"Numbered"===b.Marker?y:"Plain"===b.Marker?"":b.Marker,markerColor:b["Marker Color"]||"blue"}),opacity:"Hidden"===b.Marker?0:.9,interactive:"Hidden"!==b.Marker}))}var _,x=$("<div></div>",{id:"container"+i,class:"chapter-container"}),w=null,O=null;_=b["Media Credit Link"]?$("<a>",{text:b["Media Credit"],href:b["Media Credit Link"],target:"_blank",class:"source"}):$("<span>",{text:b["Media Credit"],class:"source"}),b["Media Link"]&&b["Media Link"].indexOf("youtube.com/")>-1&&(w=$("<iframe></iframe>",{src:b["Media Link"],width:"100%",height:"100%",frameborder:"0",allow:"autoplay; encrypted-media",allowfullscreen:"allowfullscreen"}),O=$("<div></div>",{class:"img-container"}).append(w).after(_));var M={jpg:"img",jpeg:"img",png:"img",tiff:"img",gif:"img",mp3:"audio",ogg:"audio",wav:"audio"},T=b["Media Link"]?b["Media Link"].split(".").pop().toLowerCase():"",N=M[T]||"img";console.log(1,M[T]),N&&(w=$("<"+N+">",{src:b["Media Link"],controls:"audio"===N?"controls":"",alt:b.Chapter}),"yes"===o("_enableLightbox")&&"img"===N&&(w=$("<a></a>",{"data-lightbox":b["Media Link"],href:b["Media Link"],"data-title":b.Chapter,"data-alt":b.Chapter}).append(w)),O=$("<div></div",{class:N+"-container"}).append(w).after(_)),x.append('<p class="chapter-header">'+b.Resource+"</p>").append(w?O:"").append(w?_:"").append('<p class="description">'+b.Description+"</p>"),console.log(b),$("#contents").append(x)}for(void 0,f=void 0,void 0,g=void 0,d=$(".leaflet-control-attribution")[0].innerHTML,f='View <a href="'+(a||"./csv/Chapters.csv")+'" target="_blank">data</a>',u=o("_authorName"),g=o("_authorURL"),u&&g?(g.indexOf("@")>0&&(g="mailto:"+g),f+=' by <a href="'+g+'">'+u+"</a> | "):f+=u?" by "+u+" | ":" | ",f+='View <a href="'+o("_githubRepo")+'">code</a>',o("_codeCredit")&&(f+=" by "+o("_codeCredit")),f+=" with ",$(".leaflet-control-attribution")[0].innerHTML=f+d,imgContainerHeight=parseInt(o("_imgContainerHeight")),imgContainerHeight>0&&$(".img-container").css({height:imgContainerHeight+"px","max-height":imgContainerHeight+"px"}),v[0]=-100,i=1;i<n.length;i++)v[i]=v[i-1]+$("div#container"+(i-1)).height()+70;v.push(Number.MAX_VALUE),$("div#contents").scroll((function(){var e=$(this).scrollTop();e<200&&$("#title").css("opacity",1-Math.min(1,e/100));for(var a=0;a<v.length-1;a++)if(e>=v[a]&&e<v[a+1]-140&&l!=a){location.hash=a+1,$(".chapter-container").removeClass("in-focus").addClass("out-focus"),$("div#container"+a).addClass("in-focus").removeClass("out-focus"),m(l=a),map.hasLayer(p)&&map.removeLayer(p),map.hasLayer(c)&&map.removeLayer(c);var i=n[a];if(i.Overlay){var t=parseFloat(i["Overlay Transparency"])||1,o=i.Overlay;"geojson"===o.split(".").pop()?$.getJSON(o,(function(e){p=L.geoJson(e,{style:function(e){return{fillColor:e.properties.fillColor||"#ffffff",weight:e.properties.weight||1,opacity:e.properties.opacity||t,color:e.properties.color||"#cccccc",fillOpacity:e.properties.fillOpacity||.5}}}).addTo(map)})):p=L.tileLayer(i.Overlay,{opacity:t}).addTo(map)}if(i["GeoJSON Overlay"]&&$.getJSON(i["GeoJSON Overlay"],(function(e){var a={};if(i["GeoJSON Feature Properties"]){var t=i["GeoJSON Feature Properties"].split(";");for(var o in a={},t)2===t[o].split(":").length&&(a[t[o].split(":")[0].trim()]=t[o].split(":")[1].trim())}c=L.geoJson(e,{style:function(e){return{fillColor:e.properties.fillColor||a.fillColor||"#ffffff",weight:e.properties.weight||a.weight||1,opacity:e.properties.opacity||a.opacity||.5,color:e.properties.color||a.color||"#cccccc",fillOpacity:e.properties.fillOpacity||a.fillOpacity||.5}}}).addTo(map)})),i.Latitude&&i.Longitude){var r=i.Zoom?i.Zoom:15;map.flyTo([i.Latitude,i.Longitude],r,{animate:!0,duration:2})}break}})),$("#contents").append("       <div id='space-at-the-bottom'>         <a href='#top'>            <i class='fa fa-chevron-up'></i></br>           <small>Top</small>          </a>       </div>     "),$("<style>").prop("type","text/css").html("      #narration, #title {        background-color: "+r("_narrativeBackground","white")+";         color: "+r("_narrativeText","black")+";       }      a, a:visited, a:hover {        color: "+r("_narrativeLink","blue")+"       }      .in-focus {        background-color: "+r("_narrativeActive","#f0f0f0")+"       }").appendTo("head"),endPixels=parseInt(o("_pixelsAfterFinalChapter")),endPixels>100&&$("#space-at-the-bottom").css({height:endPixels/2+"px","padding-top":endPixels/2+"px"});var S=[];for(i in h)h[i]&&(h[i].addTo(map),h[i]._pixelsAbove=v[i],h[i].on("click",(function(){var e=parseInt($(this)[0]._pixelsAbove)+5;$("div#contents").animate({scrollTop:e+"px"})})),S.push(h[i].getLatLng()));if(map.fitBounds(S),$("#map, #narration, #title").css("visibility","visible"),$("div.loader").css("visibility","hidden"),$("div#container0").addClass("in-focus"),$("div#contents").animate({scrollTop:"1px"}),parseInt(location.hash.substr(1))){var P=parseInt(location.hash.substr(1))-1;$("#contents").animate({scrollTop:$("#container"+P).offset().top},2e3)}var A=o("_googleAnalytics");if(A&&A.length>=10){var F=document.createElement("script");function H(){dataLayer.push(arguments)}F.setAttribute("src","https://www.googletagmanager.com/gtag/js?id="+A),document.head.appendChild(F),window.dataLayer=window.dataLayer||[],H("js",new Date),H("config",A)}}console.log(a,t),$.get("csv/Options.csv",(function(e){$.get("csv/Chapters.csv",(function(a){n($.csv.toObjects(e),$.csv.toObjects(a))})).fail((function(e){alert("Found Options.csv, but could not read Chapters.csv")}))})).fail((function(e){var i=function(e){return Papa.parse(Papa.unparse(e[0].values),{header:!0}).data};if(a)if(t){var o="https://sheets.googleapis.com/v4/spreadsheets/",r=a.split("/d/")[1].split("/")[0];$.when($.getJSON(o+r+"/values/Options?key="+t),$.getJSON(o+r+"/values/Chapters?key="+t)).then((function(e,a){n(i(e),i(a))}))}else alert("You load data from a Google Sheet, you need to add a free Google API key");else alert("You need to specify a valid Google Sheet (googleDocURL)")}))}));